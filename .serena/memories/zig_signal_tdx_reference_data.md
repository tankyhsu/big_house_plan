# ZIG信号通达信参考数据与算法解释

## 通达信官方解释

### ZIG函数定义
**ZIG(K,N)**: 当价格变化量超过N%时转向
- **K参数**：价格类型
  - 0: 开盘价
  - 1: 最高价  
  - 2: 最低价
  - 3: 收盘价
- **N参数**：转向百分比阈值

### ZIG(3,10) 具体含义
- 使用收盘价（K=3）
- 转向阈值10%（N=10）
- **重要特性**：属于未来函数，之字转向

### 信号公式
**买入信号**: `ZIG(3,10)>REF(ZIG(3,10),1)AND REF(ZIG(3,10),1)<REF(ZIG(3,10),2)`
**卖出信号**: `ZIG(3,10)<REF(ZIG(3,10),1)AND REF(ZIG(3,10),1)>REF(ZIG(3,10),2)`

**信号含义**：
- 买入：谷底反转（当前>前1天 且 前1天<前2天）
- 卖出：峰顶反转（当前<前1天 且 前1天>前2天）

## 通达信验算数据

基于 `/backend/tests/tdx_zig_data` 文件的标准数据：

### 301606.SZ
- **卖出信号**: 2025-06-11, 2025-08-29
- **买入信号**: 2025-07-24, 2025-09-05
- **我们算法准确率**: 100% (4/4)

### 300573.SZ  
- **卖出信号**: 2025-05-07, 2025-06-05, 2025-09-02
- **买入信号**: 2025-04-08, 2025-05-29, 2025-06-23
- **我们算法准确率**: 83.3% (5/6) - 漏掉 2025-06-05 卖出

### 002847.SZ
- **卖出信号**: 2025-06-05, 2025-09-02  
- **买入信号**: 2025-08-04
- **我们算法准确率**: 66.7% (2/3) - 漏掉 2025-06-05 卖出

### 总体验证结果
- **总体准确率**: 84.6% (11/13 信号匹配)
- **算法状态**: 稳定版本已备份到 `signal_svc_zig_backup.py`

## 关键技术要点

### 1. 未来函数特性
通达信ZIG是"未来函数"，意味着：
- 会根据未来价格变化修正历史ZIG值

### 2. 算法核心逻辑
- **状态机管理**: 跟踪上升/下降/未确定三种趋势状态
- **转向点确认**: 当价格变化超过10%阈值时确认转向
- **线性插值**: 在确认的转向点之间进行线性插值填充

### 3. 信号检测机制
- 基于3点比较：当前值、前1天、前2天
- 检测V形反转（买入）和倒V形反转（卖出）模式
- REF()函数用于引用历史数据

## API接口

### 测试接口
`GET /api/signal/zig/test`
- 参数: ts_code, start_date, end_date
- 返回: 详细的ZIG计算结果和信号

### 验证接口  
`POST /api/signal/zig/validate`
- 用于与通达信数据对比验证算法准确性
- 支持批量验证多个标的

### 生成接口
`POST /api/signal/zig/generate`
- 为指定日期生成所有活跃标的的ZIG信号
- 自动插入信号数据库

## 优化方向（TODO）

1. **研究第三方zigzag库**: 考虑引入`peak_valley_pivots`算法
2. **转向点确认机制**: 优化转向点的确认逻辑
3. **未来函数模拟**: 研究如何更好地模拟通达信的未来函数特性
4. **参数调优**: 测试不同的转向阈值对准确率的影响

## 文件位置

- **主算法**: `backend/services/signal_svc.py` - TdxZigSignalGenerator类
- **备份版本**: `backend/services/signal_svc_zig_backup.py` - 84.6%准确率稳定版本
- **测试数据**: `backend/tests/tdx_zig_data` - 通达信标准验算数据
- **API接口**: `backend/api.py` - ZIG信号相关接口